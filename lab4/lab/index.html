
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The course webpage of ECE 420 for Fall 2017">
      
      
      
      
        <link rel="shortcut icon" href="../../favicon.ico">
      
      <meta name="generator" content="mkdocs+mkdocs-material#1.0.1">
    
    
      
        <title>Lab 4 - Pitch Detection - ECE 420 - Fall 2017</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-facb31f4a3.js"></script>
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-e0a21a99ab.css">
      
      
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="ECE 420 - Fall 2017" class=" md-icon md-icon--home  md-header-nav__button">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Labs
                </span>
              
            
            Lab 4 - Pitch Detection
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
          </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-icon md-icon--home  md-nav__button">
      
    </i>
    ECE 420 - Fall 2017
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item">
    
      <a href="../.." title="Home" class="md-nav__link">
        Home
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Prelabs
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-2">
        Prelabs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../lab2/prelab/" title="Prelab 2 - IIR Filtering" class="md-nav__link">
        Prelab 2 - IIR Filtering
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../lab3/prelab/" title="Prelab 3 - Fourier Transforms" class="md-nav__link">
        Prelab 3 - Fourier Transforms
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3">
        Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../lab1/lab/" title="Lab 1 - IMU Pedometer" class="md-nav__link">
        Lab 1 - IMU Pedometer
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../lab2/lab/" title="Lab 2 - Audio Filtering" class="md-nav__link">
        Lab 2 - Audio Filtering
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../lab3/lab/" title="Lab 3 - Spectrogram" class="md-nav__link">
        Lab 3 - Spectrogram
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Lab 4 - Pitch Detection
      </label>
    
    <a href="./" title="Lab 4 - Pitch Detection" class="md-nav__link md-nav__link--active">
      Lab 4 - Pitch Detection
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#downloads" title="Downloads" class="md-nav__link">
    Downloads
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python" title="Python" class="md-nav__link">
    Python
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#voicedunvoiced-detector" title="Voiced/Unvoiced Detector" class="md-nav__link">
    Voiced/Unvoiced Detector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autocorrelation" title="Autocorrelation" class="md-nav__link">
    Autocorrelation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#big-o-notation" title="Big O Notation" class="md-nav__link">
    Big O Notation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-requirements" title="System Requirements" class="md-nav__link">
    System Requirements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android" title="Android" class="md-nav__link">
    Android
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grading" title="Grading" class="md-nav__link">
    Grading
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Resources
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4">
        Resources
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../resources/python/" title="Python" class="md-nav__link">
        Python
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../resources/android/" title="Android" class="md-nav__link">
        Android
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#downloads" title="Downloads" class="md-nav__link">
    Downloads
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python" title="Python" class="md-nav__link">
    Python
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#voicedunvoiced-detector" title="Voiced/Unvoiced Detector" class="md-nav__link">
    Voiced/Unvoiced Detector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autocorrelation" title="Autocorrelation" class="md-nav__link">
    Autocorrelation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#big-o-notation" title="Big O Notation" class="md-nav__link">
    Big O Notation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-requirements" title="System Requirements" class="md-nav__link">
    System Requirements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android" title="Android" class="md-nav__link">
    Android
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grading" title="Grading" class="md-nav__link">
    Grading
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
              
                
                <h1 id="lab-4-pitch-detection">Lab 4 - Pitch Detection</h1>
<h3 id="summary">Summary</h3>
<p>In this lab, you will learn how to detect the pitch of a signal in real time via autocorrelation. An example of the final solution can be found <a href="https://www.youtube.com/watch?v=Gsm31V8bpIU">here</a>. Next lab will utilize this pitch detector in order to do pitch synthesis a la Auto-Tune.</p>
<h3 id="downloads">Downloads</h3>
<ul>
<li>Python test harness TODO</li>
<li>Android code TODO</li>
</ul>
<h2 id="python">Python</h2>
<p>As in Lab 3, your task for the Python portion of this lab will be to prototype your Android system. For every frame of audio data, you will determine whether the frame contains background noise or a voiced signal. You will then compute the autocorrelation using a fast frequency-based method. Finally, you will determine the pitch from the autocorrelation output. These blocks are described in further detail below.</p>
<p><img alt="" src="../pitch_detector_block_diagram.png" /></p>
<!--// In this section, you will be computing the autocorrelation of bufferIn
// and picking the delay corresponding to the best match. Naively computing the
// autocorrelation in the time domain is an O(N^2) operation, and will not fit
// in your timing window.
//
// First, you will have to detect whether or not a signal is voiced.
// We will implement a simple voiced/unvoiced detector by thresholding
// the power of the signal.
//
// Next, you will have to compute autocorrelation in its O(N logN) form.
// Autocorrelation using the frequency domain is given as:
//
//  autoc = ifft(fft(x) * conj(fft(x)))
//
// where the fft multiplication is element-wise.
//
// You will then have to find the index corresponding to the maximum
// of the autocorrelation. Consider that the signal is a maximum at idx = 0,
// where there is zero delay and the signal matches perfectly.
//
// Finally, write the variable "lastFreqDetected" on completion. If voiced,
// write your determined frequency. If unvoiced, write -1.-->

<h3 id="voicedunvoiced-detector">Voiced/Unvoiced Detector</h3>
<p>Voiced/unvoiced signal classification is an <a href="https://scholar.google.com/scholar?q=voiced+unvoiced+detection&amp;hl=en&amp;as_sdt=0&amp;as_vis=1&amp;oi=scholart&amp;sa=X&amp;ved=0ahUKEwiit5CJ5-3RAhVm74MKHVD_ANsQgQMIGjAA">incredibly well-studied field</a> with a number of vetted solutions such as <a href="http://ieeexplore.ieee.org/abstract/document/1162800/">Rabiner's pattern recognition approach</a> or <a href="https://www.asee.org/documents/zones/zone1/2008/student/ASEE12008_0044_paper.pdf">Bachu's zero-crossing rate approach</a>. Pitch shifting (next lab) does not require highly-accurate voiced/unvoiced detection however, so we will use a much simpler technique.</p>
<p>The energy of a signal can be a useful surrogate for voiced/unvoiced classification. Put simply, if a signal has enough energy, we assume it is voiced and continue our pitch analysis. <a href="https://en.wikipedia.org/wiki/Energy_(signal_processing)">The energy of a discrete-time signal is given as follows:</a></p>
<p>
<script type="math/tex; mode=display">
    E_s = \sum_{n=-\infty}^{\infty} |x(n)|^2
</script>
</p>
<p>In this block, you will have to determine a useful threshold for <script type="math/tex">E_s</script> and classify frames as voiced or unvoiced depending on <script type="math/tex">E_s</script>.</p>
<h3 id="autocorrelation">Autocorrelation</h3>
<p>Autocorrelation is the process of circularly convolving a signal with itself. That is, for a real signal, the discrete autocorrelation is given as:</p>
<p>
<script type="math/tex; mode=display">
    R_{xx}[l] = x[n] \circledast x[n]
</script>
</p>
<p>The output <script type="math/tex">R_{xx}[l]</script> measures how self-similar a signal is if shifted by some lag <script type="math/tex">l</script>. If normalized to 1 at zero lag, this can be written equivalently as:</p>
<p>
<script type="math/tex; mode=display">
    R_{xx}[l] = \frac{\sum_{i=0}^N x[n] x[n - l]}{\sum_{i=0}^N x[n]^2}
</script>
</p>
<p>For a periodic signal, the lag <script type="math/tex">l</script> that maximizes <script type="math/tex">R_{xx}[l]</script> indicates the frequency of the signal. In other words, the signal takes <script type="math/tex">l</script> samples before repeating itself. This algorithm, combined with some additional modifications to prevent harmonics from being detected, comprises the <a href="http://audition.ens.fr/adc/pdf/2002_JASA_YIN.pdf">most well-known frequency estimator for speech and music</a>. </p>
<h4 id="big-o-notation">Big O Notation</h4>
<p>Unfortunately, computing <script type="math/tex">R_{xx}</script> in the time domain is an extremely slow operation. The complexity in <a href="https://www.interviewcake.com/article/java/big-o-notation-time-and-space-complexity">Big O Notation</a> is <script type="math/tex">O(N^2)</script>, meaning that if a signal has <script type="math/tex">N</script> samples, computing the autocorrelation will require <script type="math/tex">N^2</script> operations. The real-world ramifications of this is that computing the autocorrelation will be too slow to fit in our timing window.</p>
<p>Fortunately, there is a way around this. Recall that convolution in time is the same as multiplication in frequency. Convolution is generally an <script type="math/tex">O(N^2)</script> operation, but computing the FFT of a signal is only <script type="math/tex">O(N \log N)</script>. Converting to the frequency domain then, we have the following equation:</p>
<p>
<script type="math/tex; mode=display">
    R_{xx}[l] = \mathcal{F}^{-1}\left\{ \mathcal{F}\left\{x\right\} \tilde{\mathcal{F}}\left\{x\right\} \right\},
</script>
</p>
<p>or in pseudocode, <code>autoc = ifft(fft(x) * conj(fft(x))</code>. This is an enormously powerful result. Computing the FFT or inverse FFT is only <script type="math/tex">O(N \log N)</script>, and element-wise multiplication only <script type="math/tex">O(N)</script>. We can reuse the result of one of the FFTs to only require one FFT, one inverse FFT, and one full multiplication. Our total computational complexity is then <script type="math/tex">O(2 N \log N + N)</script>. Big O notation typically drops all but the dominant term, so our final cost is <script type="math/tex">O(N \log N)</script>.</p>
<div class="admonition tip">
<p class="admonition-title">Note</p>
<p>For visualization, the table below demonstrates the growth in <script type="math/tex">N</script> of the two Big O costs.</p>
<table>
<thead>
<tr>
<th>
<script type="math/tex">N</script>
</th>
<th>
<script type="math/tex">O(N^2)</script> number of operations</th>
<th>
<script type="math/tex">O(N \log N)</script> number of operations</th>
</tr>
</thead>
<tbody>
<tr>
<td>10</td>
<td>100</td>
<td>10</td>
</tr>
<tr>
<td>100</td>
<td>10000</td>
<td>200</td>
</tr>
<tr>
<td>1000</td>
<td>1000000</td>
<td>3000</td>
</tr>
<tr>
<td>10000</td>
<td>100000000</td>
<td>40000</td>
</tr>
<tr>
<td>100000</td>
<td>10000000000</td>
<td>500000</td>
</tr>
<tr>
<td>1000000</td>
<td>1000000000000</td>
<td>6000000</td>
</tr>
</tbody>
</table>
</div>
<h3 id="system-requirements">System Requirements</h3>
<p>The Python test code has been given to mimic the final Android system. You will get an input frame of size 2880, corresponding to 60 ms of data, and you will determine the pitch (if it is voiced). If the pitch is unvoiced, you should return -1. Some things to think about:</p>
<ul>
<li>The autocorrelation will be periodic for speech signals with many candidate peaks. How do you decide which peak to use? </li>
<li>The autocorrelation will be maximal in the neighborhood surrounding zero lag. How do you decide what to ignore? </li>
<li>Why did we choose 60 ms frames?</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Assignment</p>
<p>Implement the Python system described above. Plot the output frequency over time to see if your system works as expected. </p>
<p>Do not rely on built-in functions such as <code>np.correlate()</code>, and don't worry about frame boundaries.</p>
</div>
<h2 id="android">Android</h2>
<h2 id="grading">Grading</h2>
<p>Your lab will be graded as follows:</p>
<ul>
<li>Prelab (2 points) </li>
<li>Lab (4 points) </li>
<li>Quiz (2 points) </li>
</ul>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../lab3/lab/" title="Lab 3 - Spectrogram" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Lab 3 - Spectrogram
              </span>
            </div>
          </a>
        
        
          <a href="../../resources/python/" title="Python" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Python
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-16f434a21a.js"></script>
      <script>var config={url:{base:"../.."}},app=new Application(config);app.initialize()</script>
      
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
    
      
    
  </body>
</html>